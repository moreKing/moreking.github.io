import{_ as i,c as a,ai as n,o as e}from"./chunks/framework.DcWFUpHS.js";const F=JSON.parse('{"title":"centos7 升级 openssh9.8p1","description":"","frontmatter":{},"headers":[],"relativePath":"linux/update-openssh.md","filePath":"linux/update-openssh.md","lastUpdated":1728525201000}'),l={name:"linux/update-openssh.md"};function p(h,s,t,r,k,d){return e(),a("div",null,s[0]||(s[0]=[n(`<h1 id="centos7-升级-openssh9-8p1" tabindex="-1">centos7 升级 openssh9.8p1 <a class="header-anchor" href="#centos7-升级-openssh9-8p1" aria-label="Permalink to &quot;centos7 升级 openssh9.8p1&quot;">​</a></h1><br><div class="danger custom-block"><p class="custom-block-title">警告</p><p>注意，此操作请在测试环境下先测试，再对生产服务器进行操作</p></div><h3 id="_1-安装所需编译依赖包" tabindex="-1">1. 安装所需编译依赖包 <a class="header-anchor" href="#_1-安装所需编译依赖包" aria-label="Permalink to &quot;1. 安装所需编译依赖包&quot;">​</a></h3><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build-essential</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> perl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gcc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gcc-c++</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pam-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  openssl-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  zlib-devel</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_2-升级-openssl-版本" tabindex="-1">2. 升级 openssl 版本 <a class="header-anchor" href="#_2-升级-openssl-版本" aria-label="Permalink to &quot;2. 升级 openssl 版本&quot;">​</a></h3><p>由于<code>openssh9.8</code>版本依赖的最低版本<code>openssl1.1.1</code>,centos7 内置的默认版本为 <code>OpenSSL 1.0.2k-fips</code> 不能满足升级要求，因此必须先进行 openssl 升级</p><p>下载源码地址 <a href="https://github.com/openssl/openssl/releases/tag/OpenSSL_1_1_1w" target="_blank" rel="noreferrer">https://github.com/openssl/openssl/releases/tag/OpenSSL_1_1_1w</a></p><h4 id="_2-1-卸载原-openssl" tabindex="-1">2.1 卸载原 openssl <a class="header-anchor" href="#_2-1-卸载原-openssl" aria-label="Permalink to &quot;2.1 卸载原 openssl&quot;">​</a></h4><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openssl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/ssl/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/ssl_bak</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-2-源码编译安装" tabindex="-1">2.2 源码编译安装 <a class="header-anchor" href="#_2-2-源码编译安装" aria-label="Permalink to &quot;2.2 源码编译安装&quot;">​</a></h4><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --prefix=/usr/local/openssl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -j</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/openssl/bin/openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/bin/openssl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/openssl/include/openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/include/openssl</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/openssl/lib/libssl.so.1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/lib64/libssl.so.1.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/openssl/lib/libcrypto.so.1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/lib64/libcrypto.so.1.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-升级-openssh" tabindex="-1">3. 升级 openssh <a class="header-anchor" href="#_3-升级-openssh" aria-label="Permalink to &quot;3. 升级 openssh&quot;">​</a></h3><p>下载：<a href="https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-9.8p1.tar.gz" target="_blank" rel="noreferrer">https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-9.8p1.tar.gz</a></p><p>备份原配置：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/ssh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/ssh.bak</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/bin/ssh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/bin/ssh.bak</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/sbin/sshd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/sbin/sshd.bak</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/pam.d/sshd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/pam.d/sshd.old</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>安装</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openssh-9.8p1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./configure</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --sysconfdir=/etc/ssh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --with-ssl-dir=/usr/local/openssl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>重启操作系统 查看 ssh 版本</strong></p>`,19)]))}const c=i(l,[["render",p]]);export{F as __pageData,c as default};
